---
layout: post
title: "[개발일지] 텔레그램 모니터링 시스템 1"
tags: [개발일지, 텔레그램, Python]
comments: true
---

텔레그램 모니터링 시스템 개발과정

> 이렇게까지 커질줄 몰랐던, 새싹에서 시작해 나무로 자라난 프로젝트

---
## (1) 개요
보안관제 업무를 진행하다 보면, 사기업의 경우 단순 네트워크 트래픽 탐지 뿐만 아니라 보안 동향을 파악하는 과업을 같이 수행하기도 한다. 국내외 최신 동향을 파악하여 보고서를 작성하는 일 뿐만 아니라, 크리덴션 스터핑 방지를 위해 오픈된 db 등의 데이터로부터 아이디 또는 이메일 등의 문자열이 확인되는지를 파악한다.

우리 팀은 PM님의 아이디어 하에 고객사의 크리덴셜 스터핑 방지를 위해 텔레그램 모니터링을 진행하고자 했다.

PM님이 기존에 관리하고 있던 텔레그램 채널 몇개와, 우리 팀이 추가적으로 찾은 채널에 대한 집중 모니터링을 진행하기 시작했다.

### 1. 구상
처음에는 지정한 몇개의 채널에 접속하여, 수동으로 파일을 다운받아 문자열 ex) @eric을 검색하였다. 채널의 수가 적으면 수동으로 충분히 감당할 수 있지만, 채널이 많아지면 시간과 인력 소모가 굉장히 많아질 것이라 판단하여, python으로 다운로드와 검색이 가능한 스크립트를 찾아보기로 했다.

### 2. 문제점
그러나, 인터넷에 오픈되어 있는 소스들은 대부분 너무 복잡했으며, 스크립트에 내가 원하는 기능을 마음대로 추가하기 복잡했으므로 그대로 활용하기 어려웠다.

또한 해당 소스코드에 보안상의 허점과 문제를 식별하기도 어렵기에 그대로 실행하기엔 어렵다는 결론에 다달았다.

결국 학교에서 배우고 현장실습 때 가다듬은 자동화에 최적화된 언어 python으로 개발하기로 했다.

## (2) 설계
소스코드를 짜기 전에, 프로그램을 어떤식으로 구동할 것인지 생각해보았다.

우리는 먼저 1. 데이터를 채널로부터 추출해야하고, 2. 그 다음 특정 문자열을 검색하고, 3. 검색 결과를 출력해야한다.

이렇게 3단계를 거치면 좋겠다고 생각했다. 또, 이를 하나의 스크립트에 우겨넣으면 에러가 무지막지하게 발생하겠다 싶어서, 3개의 별도의 스크립트와, 이를 실행시킬 하나의 스크립트를 작성하기로 생각했다.

## (3) 제작
### 1. 텔레그램 클라이언트 접근 및 다운로드 코드
아래는 텔레그램 클라이언트 접근 및 채널에서 파일 검색을 검색하고 다운로드를 진행하는 코드이다.

#### 1-1. 클라이언트 접근
![스크린샷 2024-04-25 오후 2 23 19](https://github.com/what0302/what0302.github.io/assets/18510716/9514cfda-d26a-46d5-b5c4-29a7ec77da89)

우선, 'telethon' 라이브러리를 이용해야한다. 

telethon은 파이썬 텔레그램 클라이언트 모듈이다. 이를 이용해 텔레그램을 별도로 실행하지 않아도 텔레그램 클라이언트에 접근이 가능하며, 파일 다운로드가 가능하다.

#### 1-2. 채널 매핑
![image](https://github.com/what0302/what0302.github.io/assets/18510716/2bcb88a3-a95a-4d30-ba79-4583b4ceac28)


